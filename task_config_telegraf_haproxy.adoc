---
sidebar: sidebar 
permalink: task_config_telegraf_haproxy.html 
keywords: telegraf, installation, install, haproxy 
summary: HAProxy 資料收集器配置 
---
= HAProxy 資料收集器
:hardbreaks:
:allow-uri-read: 


[role="lead"]
Data Infrastructure Insights使用此資料收集器從 HAProxy 收集指標。



== 安裝

. 從*可觀察性 > 收集器*中，按一下*+資料收集器*。選擇 HAProxy。
+
選擇安裝 Telegraf 代理程式的作業系統或平台。

. 如果您尚未安裝用於收集的代理，或者您希望為不同的作業系統或平台安裝代理，請按一下「顯示說明」以展開link:task_config_telegraf_agent.html["代理安裝"]指示。
. 選擇用於此資料收集器的代理存取金鑰。您可以透過點擊 *+ 代理存取金鑰* 按鈕新增新的代理存取金鑰。最佳實務：只有當您想要對資料收集器進行分組（例如按作業系統/平台）時才使用不同的代理存取金鑰。
. 依照設定步驟配置資料收集器。說明根據您用於收集資料的作業系統或平台的類型而有所不同。


image:HAProxyDCConfigLinux.png["HAProxy 配置"]



== 設定

Telegraf 的 HAProxy 外掛程式依賴 HAProxy Stats 的支援。這是 HAProxy 內建的配置，但它並非開箱即用。啟用後，HAProxy 將公開一個 HTML 端點，您可以在瀏覽器上查看該端點，也可以抓取該端點以提取所有 HAProxy 配置的狀態。



=== 相容性:

配置是針對 HAProxy 版本 1.9.4 開發的。



=== 設定:

要啟用統計訊息，請編輯您的 haproxy 設定檔並在「預設」部分後添加以下行，使用您自己的使用者/密碼和/或 haproxy URL：

[listing]
----
stats enable
stats auth myuser:mypassword
stats uri  /haproxy?stats
----
以下是啟用統計資訊的簡化範例設定檔：

[listing]
----
global
  daemon
  maxconn 256

defaults
  mode http
  stats enable
  stats uri /haproxy?stats
  stats auth myuser:mypassword
  timeout connect 5000ms
  timeout client 50000ms
  timeout server 50000ms

frontend http-in
  bind *:80
  default_backend servers

frontend http-in9080
  bind *:9080
  default_backend servers_2

backend servers
  server server1 10.128.0.55:8080 check ssl verify none
  server server2 10.128.0.56:8080 check ssl verify none

backend servers_2
  server server3 10.128.0.57:8080 check ssl verify none
  server server4 10.128.0.58:8080 check ssl verify none
----
有關完整和最新的說明，請參閱link:https://cbonte.github.io/haproxy-dconv/1.8/configuration.html#4-stats%20enable["HAProxy 文檔"]。



== 物體和計數器

收集以下物件及其計數器：

[cols="<.<,<.<,<.<,<.<"]
|===
| 目的： | 標識符： | 屬性： | 數據點： 


| HAProxy 前端 | 命名空間地址代理 | 節點 IP 節點名稱 代理 ID 模式 進程 ID 會話速率限制 伺服器 ID 會話限制狀態 | 傳入位元組數 傳出位元組數 快取命中數 快取查找數 壓縮 繞過的位元組數 傳入壓縮 傳出位元組數 快取命中數 快取查找數 壓縮 繞過的位元組數 傳入壓縮 傳出位元組數 壓縮回應數 連線速率 連線速率 最大連線數 連線規則拒絕的請求總數 安全性考慮拒絕的請求數為 5其他請求 攔截的會話速率 會話速率 最大請求速率 請求速率 最大請求速率 總會話數 會話數 最大會話數 總請求數 重寫 


| HAProxy 伺服器 | 命名空間位址代理伺服器 | 節點IP 節點名稱 檢查完成時間 檢查下降配置 檢查健康值 檢查上升配置 檢查狀態 代理ID 上次更改時間 上次會話時間 模式 進程ID 伺服器ID 狀態權重 | 活動伺服器 備份伺服器 輸入位元組數 輸出位元組數 檢查停機數 檢查失敗數 用戶端中止連線數 連線平均時間 停機時間 拒絕回應總數 連線錯誤數 回應錯誤數 回應 1xx 數 回應 2xx 數 回應 3xx 數 工作階段 4xx 數位回應 5 數 佇列時間佇列其他數位伺服器最大連線重用數 回應時間 平均會話數 最大會話數 伺服器傳輸中止數 會話總數 會話總數 總時間 平均請求數 重新分派數 請求數 重試數 請求數 重寫數 


| HAProxy 後端 | 命名空間地址代理 | 節點IP 節點名稱 代理ID 上次更改時間 上次會話時間 模式 進程ID 伺服器ID 會話限制 狀態 權重 | 活動伺服器 備份伺服器 傳入位元組數 傳出位元組數 快取命中數 快取查找數 檢查失敗數 用戶端中止數 壓縮 繞過的位元組數 壓縮傳入位元組數 壓縮傳出位元組數 壓縮回應數 連線數 連線平均時間 停機時間 因安全問題拒絕回應數回應數 5xx 回應數 選定的其他伺服器 總計 佇列數 目前佇列數 最大佇列數 平均時間 每秒會話數 每秒會話數 最大請求數 總連線重用數 回應時間 平均會話數 最大會話數 伺服器傳送中止數 會話數 會話總數 時間 平均請求數 重新分派數 最大會話數 伺服器傳送中止數 會話數 會話總數 
|===


== 故障排除

更多資訊可從link:concept_requesting_support.html["支援"]頁。
